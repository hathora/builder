<div class="hathora-logo-with-super">
  <img src="statics/logo.svg" alt="drawing" width="200"/>
  <span class="hathora-logo-super">Cloud</span>
</div>

Hathora Cloud is a managed deployment platform for your games. You can always self-host your application in your own instructure around the globe, or you can let us manage it for you.

Applications deployed Hathora Cloud must conform to the Hathora Protocol, which can be easily done with the use of the Build Kit. Please refer to the [Hathora BuildKit](../buildkit/README.md) documentation to learn more about developing Hathora Cloud compatible applications.

> Currently Hathora Cloud is in a private beta. If you'd like access, please [sign up here](https://forms.gle/pyYms6TwUJHTm62y8) and we'll be in touch soon.

### Pre-requisites

1. [Request developer access](https://forms.gle/pyYms6TwUJHTm62y8) to Hathora Cloud
1. Latest Hathora CLI, install with `npm i -g hathora`.
1. A `hathora.yml` file in the working directory to designate a Hathora project (you can leave this empty for now).
1. A `Dockerfile` which will package up your application. An example one can be found [here](https://github.com/hathora/topdown-shooter/blob/develop/Dockerfile).

### Getting Started

1. Once our team confirms access, run `hathora cloud login`.
1. Select `y` when prompted with the message below and confirm that the browser window that opens displays the same code.
   > Open browser for login? You should see the following code: XXXX-XXXX. › (Y/n)
1. Complete the login flow and close the browser window. You will see a green message in your terminal once the login is successful.
   > Successfully logged in! Saved credentials to ~/.config/hathora/token
1. Navigate to the project root for your game and confirm there is a Dockerfile (this file is automatically generated when you run `hathora init`)

```
. # project root
├─ client
│  ├─ prototype-ui
│  └─ web
└─ Dockerfile
└─ server
```

5. Run `hathora cloud deploy --appName ${MY_GAME_NAME}` to deploy your game globally. If this is your first time deploying the game, you can name your app whatever you'd like. It will take a few minutes for your app to be deployed and you can watch the logs for progress.
6. To connect a local client to the deployed servers, first get the `APP_SECRET` using `hathora cloud list`. Run your frontend locally as follows

```sh
export APP_SECRET=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
hathora dev --only client
```

## Destroying

To destory your application run `hathora cloud destroy --appName ${MY_GAME_NAME}`. This will immediately stop all running instances and delete the project from Hathora Cloud.

## Continuous Delivery

Once you have manual deploys working, you may want to set up Continuous Delivery to automate the deploy process. We will walk through an example for setting up CI/CD using Github Actions, but the general principles apply to other CI systems as well.

In your Github Repo, select the actions tab and create a custom `.yml` file, for example `deploy.yml`. Replace the auto-generated code with the following:

```yml
name: Deploy
on:
  push:
    branches:
      - main

env:
  APP_NAME: YOUR_APP_NAME_HERE
  APP_ID: YOUR_APP_ID_HERE

jobs:
  server:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm install -g hathora
      - run: hathora cloud deploy --appName $APP_NAME --token ${{ secrets.HATHORA_TOKEN }}
  frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm ci
      - run: npm install hathora -g
      - run: APP_SECRET=${{ secrets.HATHORA_APP_SECRET }} hathora build --only client
      - run: echo '/* /index.html 200' > client/web/dist/_redirects
      - uses: jsmrcaga/action-netlify-deploy@v1.1.0
        with:
          NETLIFY_DEPLOY_TO_PROD: true
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          build_directory: client/web/dist
```

Make sure the following are set properly:

- `APP_NAME` matches the name that was used on the initial deploy
- Secrets. Save the secret on Github by going to _Repo Settings --> Secrets --> Actions_ and creating a `New Repository Secret`. Name the secret `HATHORA_TOKEN` to match `.yml` file above. Paste in the copied value in the `Secret` field.
  - `HATHORA_TOKEN` which can be found in `~/.config/hathora/token`.
    > WARNING: if using `cat` to get the token from the terminal, don't include the **%** character at the end
  - `NETLIFY_SITE_ID` and `NETLIFY_AUTH_TOKEN` if you're using Netlify to host your frontend

> If you're using Personal Access Tokens to push up your code to Github, make sure in _Profile Settings --> Developer Access --> Personal access tokens_ that `workflow` access is enabled for your token.
> Note you must have already run `hathora cloud login` for the token to be present.

In this example, the frontend is hosted on Netlify so you will need to get `NETLIFY_SITE_ID` and `NETLIFY_AUTH_TOKEN` from them directly.

Push a change to the branch specified in the `.yml` file. Once you push your changes, go to `Github Actions` tab to see your deployment logs.
